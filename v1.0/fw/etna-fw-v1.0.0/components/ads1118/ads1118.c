// ******************************************************************************************************************************************************************
// @file:   
// @brief:  
//
// Created by Dominic Moffat on 11/12/2017.
// Copyright Â© 2017 Illysky. All rights reserved.
// ******************************************************************************************************************************************************************

#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include "ads1118.h"


// **************************************************************************************************************************************************************************
//  @func
//  @brief
// **************************************************************************************************************************************************************************
uint8_t ads1118_conversion_complete (void) 
{
	uint32_t state = 0; 
	ads1118_hal_cs_assert();
	state = ads1118_hal_drdy (); 
	ads1118_hal_cs_deassert();
	if (state) 	return 0; 
	else 				return 1; 
}

// **************************************************************************************************************************************************************************
//  @func
//  @brief
// **************************************************************************************************************************************************************************
uint32_t 	ads1118_transfer (uint16_t* config, int16_t* conversion)
{
	uint32_t result = 0;
	uint32_t data = 0; 
	uint8_t tx[16]; 
	uint8_t rx[16];
	memset(rx, 0, 16); 
	
	tx[0] = (*config >> 8) & 0xFF; 	
	tx[1] = (*config >> 0) & 0xFF; 
	tx[3] = 0x00; 			// Dummy
	tx[4] = 0x00; 			// Dummy
	
	ads1118_hal_cs_assert();
	result = ads1118_hal_transfer (tx, rx, 4); 
	ads1118_hal_cs_deassert();
	
	// Copy to our pointers
	*conversion = ((uint32_t) rx[0]) << 8; 
	*conversion |= ((uint32_t) rx[1]); 
	*config = ((uint32_t) rx[2]) << 8; 
	*config |= ((uint32_t) rx[3]); 
	
	if (result != 0) {
		*conversion = 0; 
		*config = 0; 
	}
	
	
	return result; 
}





